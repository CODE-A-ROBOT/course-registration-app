<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kurswahl</title>
</head>
<body>

  <h1>Kurswahl </h1>

  <form id="courseForm">
    <h2>Prüfungsfächer</h2>

    <h3>Schule</h3>

    <div class="course-selection">
      <label for="schoolSelect">Schule:</label>
      <select id="schoolSelect" name="schoolSelect" onchange="filterOptions('schoolSelect', 'column1Select')"></select>
    </div>

    <h3>Leistungskursfächer</h3>
    <div class="course-selection">
      <label for="column1Select">Leistungskursfach 1:</label>
      <select id="column1Select" name="column1Select" onchange="filterOptions('column1Select', 'column2Select')"></select>
    </div>

    <div class="course-selection">
      <label for="column2Select">Leistungskursfach 2:</label>
      <select id="column2Select" name="column2Select" onchange="filterOptions('column2Select', 'column3Select')"></select>
    </div>

    <h3>Prüfungsfächer</h3>
    <div class="course-selection">
      <label for="column3Select">Prüfungsfach 3:</label>
      <select id="column3Select" name="column3Select" onchange="filterOptions('column3Select', 'column4Select')"></select>
    </div>

    <div class="course-selection">
      <label for="column4Select">Prüfungsfach 4:</label>
      <select id="column4Select" name="column4Select" onchange="filterOptions('column4Select', 'column5Select')"></select>
    </div>

    <h3>5. PK</h3>
    <div class="course-selection">
      <label for="column5Select">Referenzfach:</label>
      <select id="column5Select" name="column5Select" onchange="filterOptions('column5Select', 'column6Select')"></select>
    </div>

    <h3>weitere Grundkurse mit Belegverpflichtung</h3>
    <div class="course-selection">
      <label for="column6Select">De:</label>
      <select id="column6Select" name="column6Select" onchange="filterOptions('column6Select', 'column7Select')"></select>
    </div>

    <div class="course-selection">
      <label for="column7Select">FS</label>
      <select id="column7Select" name="column7Select" onchange="filterOptions('column7Select', 'column8Select')"></select>
    </div>

    <div class="course-selection">
      <label for="column8Select">Ge:</label>
      <select id="column8Select" name="column8Select" onchange="filterOptions('column8Select', 'column9Select')"></select>
    </div>

    <div class="course-selection">
      <label for="column9Select">PW</label>
      <select id="column9Select" name="column9Select" onchange="filterOptions('column9Select', 'column10Select')"></select>
    </div>

    <div class="course-selection">
      <label for="column10Select">Ma</label>
      <select id="column10Select" name="column10Select"></select>
    </div>

    <br>
    <button type="button" onclick="submitForm()">Submit</button>
  </form>

  <script>
let data; // Declare the data variable
let subjectsData;
let subjectsMap;

// New function to fetch and parse subjects.json
async function fetchSubjects() {
  try {
    const response = await fetch('subjects.json');
    if (!response.ok) {
      throw new Error(`Failed to fetch subjects.json. Status: ${response.status}`);
    }
    const subjectsData = await response.json();

    // Create a map for quick access
    subjectsMap = new Map(subjectsData.map(item => [item.label, item.subjects]));

  } catch (error) {
    console.error(error);
  }
}

// Call fetchSubjects when the page loads
document.addEventListener('DOMContentLoaded', fetchSubjects);

// ... (existing code)

// Updated fetchAndPopulateSelect function
// ... (existing code)

// Updated fetchAndPopulateSelect function
async function fetchAndPopulateSelect(selectId, data) {
  const select = document.getElementById(selectId);
  // Clear existing options
  select.innerHTML = '';

  // Create the default option for the school dropdown
  if (selectId === 'schoolSelect') {
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.text = 'Select...';
    select.appendChild(defaultOption);
  }

  const uniqueValues = [...new Set(data.map(item => item[selectId]))];
  uniqueValues.forEach(value => {
    const option = document.createElement('option');
    option.value = value;
    option.text = value;
    select.appendChild(option);
    console.log(`Option value: ${value}`);

    // Check if the selected value corresponds to a label in subjects.json
    if (subjectsMap && subjectsMap.has(value)) {
      // Log the value to check if this block is being executed
      console.log(`Creating subject dropdown for ${value}`);
      // Create a new dropdown for subjects
      createSubjectDropdown(subjectsMap.get(value), selectId);
    }
  });
}

// ... (existing code)

// New function to create a dropdown for subjects
function createSubjectDropdown(subjectsList, selectId) {
  const parentDiv = document.getElementById('courseForm'); // Use the appropriate parent element

  const subjectSelect = document.createElement('select');
  subjectSelect.id = `${selectId}SubjectSelect`;
  subjectSelect.name = `${selectId}SubjectSelect`;

  subjectsList.split(',').forEach(subject => {
    const option = document.createElement('option');
    option.value = subject.trim();
    option.text = subject.trim();
    subjectSelect.appendChild(option);
  });

  parentDiv.appendChild(subjectSelect);
}

    async function filterOptions(sourceSelectId, targetSelectId) {
      const sourceSelect = document.getElementById(sourceSelectId);
      const targetSelect = document.getElementById(targetSelectId);

      // Get the selected value from the source select
      const selectedValue = sourceSelect.value;

      // Filter the data based on the selected value
      const filteredData = data.filter(item => item[sourceSelectId] === selectedValue);

      // Repopulate the target select with the first available option
      fetchAndPopulateSelect(targetSelectId, filteredData);

      // Trigger change event for the target select to continue the cascade
      const event = new Event('change');
      targetSelect.dispatchEvent(event);
    }


   // Updated fetchCourses function
async function fetchCourses() {
  try {
    // Fetch data.json
    const dataResponse = await fetch('data.json');
    if (!dataResponse.ok) {
      throw new Error(`Failed to fetch data.json. Status: ${dataResponse.status}`);
    }
    data = await dataResponse.json();

    // Fetch subjects.json
    const subjectsResponse = await fetch('subjects.json');
    if (!subjectsResponse.ok) {
      throw new Error(`Failed to fetch subjects.json. Status: ${subjectsResponse.status}`);
    }
    subjectsData = await subjectsResponse.json();

    // Fetch and populate the School select
    fetchAndPopulateSelect('schoolSelect', data);

    // Initialize subjectsMap
    subjectsMap = new Map(subjectsData.map(item => [item.label, item.subjects]));

    // Log the subjectsMap for debugging
    console.log('subjectsMap:', subjectsMap);
  } catch (error) {
    console.error(error);
  }
}

// ... (rest of your script)


    // Fetch courses when the page loads
    document.addEventListener('DOMContentLoaded', fetchCourses);

    // Additional function to submit the form
    function submitForm() {
      // Add your logic to handle the selected values (e.g., send them to the server)
      // Access the selected values using document.getElementById('selectId').value
      console.log('Form submitted!');
    }
  </script>
</body>
</html>
